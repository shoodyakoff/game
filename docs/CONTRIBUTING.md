# Руководство для разработчиков

## Обзор проекта

Game Portal - это веб-приложение для игровой платформы, разработанное с использованием:
- **Next.js** - фреймворк React для фронтенда и API
- **MongoDB** - база данных для хранения информации
- **NextAuth.js** - аутентификация и авторизация
- **Docker** - контейнеризация для локальной разработки и деплоя

## Настройка окружения разработки

### Требования

- Node.js (версия 18+)
- Docker и Docker Compose
- Git
- MongoDB Tools (опционально, для синхронизации баз данных)

### Настройка локального окружения

1. **Клонирование репозитория**
   ```bash
   git clone https://github.com/username/game.git
   cd game
   ```

2. **Настройка переменных окружения**
   - Создайте файл `.env.local` на основе `.env.example`
   - Укажите правильные значения для подключения к базе данных и других настроек

3. **Запуск приложения в Docker**
   ```bash
   # Запуск контейнеров
   npm run docker:up
   
   # Заполнение базы данных тестовыми данными
   npm run db:seed
   ```

4. **Доступ к приложению**
   - Откройте http://localhost:3000 в браузере
   - Используйте тестовые учетные данные из скрипта seed.js

## Рабочий процесс разработки

### Базы данных

В проекте используются два различных окружения базы данных:

1. **Локальная MongoDB в Docker** (для разработки)
   - Запускается вместе с приложением через docker-compose
   - Данные хранятся в томе Docker и сохраняются между перезапусками
   - Инициализируется скриптами из директории mongo-init/
   - Строка подключения: `mongodb://localhost:27017/game-portal`

2. **MongoDB Atlas** (для продакшена)
   - Облачная база данных с реальными пользовательскими данными
   - Используется для развертывания на хостинге
   - Строка подключения: `mongodb+srv://...`

### Команды для работы с базой данных

```bash
# Заполнение локальной БД тестовыми данными
npm run db:seed

# Синхронизация локальной БД с MongoDB Atlas (скачивание продакшен данных)
npm run db:sync
```

### Работа с Git и коммиты

**Важно:** не коммитьте чувствительные данные в репозиторий!

1. **Перед коммитом проверьте файлы:**
   ```bash
   git status
   ```

2. **Убедитесь, что следующие файлы не попадут в репозиторий:**
   - .env.local
   - .env.production
   - /backup/* (директория с бэкапами БД)
   - Любые приватные ключи или токены

3. **Следуйте соглашениям по именованию коммитов:**
   ```
   feat: добавление новой функциональности
   fix: исправление ошибки
   docs: изменения в документации
   style: форматирование, пропущенные точки с запятой
   refactor: реорганизация кода, не меняющая функциональность
   test: добавление или исправление тестов
   chore: обновление задач сборки, настроек пакетного менеджера
   ```

## Структура проекта

```
game/
├── docs/                   # Документация
├── mongo-init/             # Скрипты инициализации MongoDB
├── public/                 # Статические файлы
├── scripts/                # Скрипты для управления БД
├── src/                    # Исходный код
│   ├── components/         # React компоненты
│   ├── pages/              # Next.js страницы и API
│   ├── server/             # Серверный код
│   │   ├── config/         # Конфигурация сервера
│   │   ├── controllers/    # Контроллеры
│   │   ├── middleware/     # Middleware
│   │   ├── models/         # Модели MongoDB
│   │   └── utils/          # Утилиты
│   └── styles/             # CSS стили
├── .env.example            # Шаблон для .env файлов
├── .env.local              # Локальные переменные окружения (не коммитить!)
├── .env.production         # Продакшен переменные (не коммитить!)
├── .gitignore              # Файлы, исключаемые из Git
├── docker-compose.yml      # Конфигурация Docker для локальной разработки
├── docker-compose.prod.yml # Конфигурация Docker для продакшена
├── Dockerfile              # Инструкции для сборки образа Docker
├── package.json            # Зависимости и скрипты npm
└── README.md               # Основная документация
```

## Деплой

### На локальный сервер

1. **Сборка для продакшена:**
   ```bash
   npm run build
   ```

2. **Запуск в режиме продакшена через Docker:**
   ```bash
   docker-compose -f docker-compose.prod.yml up -d
   ```

### На Timeweb Cloud

Для деплоя на Timeweb Cloud, следуйте инструкции в файле `docs/DEPLOY.md`.

## Часто задаваемые вопросы

### Как добавить нового тестового пользователя?

Добавьте его в массив `seedUsers` в файле `scripts/seed.js` и запустите `npm run db:seed`.

### Как обновить структуру базы данных?

1. Обновите схему в `src/server/models/`.
2. При необходимости, создайте миграционный скрипт в директории `scripts/`.

### Что делать при конфликтах с MongoDB?

Если вы столкнулись с проблемами MongoDB:
1. Проверьте подключение: `docker-compose logs mongodb`
2. Перезапустите контейнеры: `npm run docker:restart`
3. В крайнем случае, удалите том и инициализируйте БД заново:
   ```bash
   npm run docker:down
   docker volume rm game_mongodb_data
   npm run docker:up
   npm run db:seed
   ``` 