# Технические заметки по масштабированию проекта

В этом документе описаны технические аспекты, которые следует учитывать при масштабировании проекта.

## Структура Redux

Для управления состоянием приложения используется Redux Toolkit. Основные слайсы:

- `src/store/slices/characterSlice.ts`: Управление выбором персонажа

## Аутентификация

Для аутентификации используется NextAuth.js. Ключевые файлы:
- `src/pages/api/auth/[...nextauth].ts`: Конфигурация NextAuth с кастомными колбэками
- `src/components/auth/ProtectedRoute.tsx`: HOC для защиты страниц

## Управление профилем пользователя

### Текущая реализация
- Профиль пользователя отображается из данных localStorage
- Обновление профиля имитируется через таймауты
- Реальное обновление данных не происходит

### Код, требующий изменений
- `src/pages/profile/index.tsx`:
  - Функция `handleProfileUpdate` должна быть заменена на реальный API-запрос
  - Функция удаления аккаунта должна отправлять запрос на сервер

## Система персонажей

### Текущая реализация
- Персонажи хранятся локально в Redux и localStorage
- Выбор персонажа сохраняется через Redux slice `characterSlice.ts`
- Проверка выбранного персонажа осуществляется через `ProtectedRoute` компонент
- Для доступа к уровням требуется выбор персонажа

### Код, требующий изменений
- `src/store/slices/characterSlice.ts`:
  - Необходимо добавить реальные API-запросы для сохранения персонажа в БД
  - Реализовать синхронизацию с сервером при выборе персонажа
  - Добавить обработку ошибок при сетевых запросах

## Сохранение игрового прогресса

### Текущая реализация
- Данные о прогрессе уровней сохраняются в localStorage браузера
- Информация о выбранном персонаже хранится в Redux store и дублируется в localStorage
- В Redux store используется characterSlice с функциями для управления выбором персонажа
- Прогресс по уровням хранится в localStorage в ключах вида `level1_progress`, `level2_progress`
- Список завершенных уровней хранится в localStorage в ключе `completedLevels`
- Достижения и награды временно хранятся в компонентах и теряются при перезагрузке страницы

### Недостатки текущего подхода
- Данные привязаны к конкретному устройству и браузеру
- Отсутствие синхронизации между устройствами
- Ограниченный объем хранения в localStorage
- Отсутствие возможности аналитики и мониторинга прогресса
- Риск потери данных при очистке кэша браузера

### Требуемая реализация
- Создание серверной части с MongoDB для хранения всех пользовательских данных:
  - Таблица пользователей (Users)
  - Таблица персонажей (Characters)
  - Таблица прогресса (Progress)
  - Таблица достижений (Achievements)
  - Таблица наград (Rewards)
- API для сохранения и восстановления прогресса
- Механизм синхронизации между устройствами
- Возможность сохранения прогресса в оффлайн-режиме с последующей синхронизацией
- Сохранение истории действий пользователя для аналитики

### Примерная структура данных в MongoDB

#### Коллекция Progress:
```json
{
  "_id": "ObjectId",
  "userId": "ObjectId",
  "characterId": "ObjectId",
  "levelProgress": [
    {
      "levelId": "Number",
      "currentStage": "String",
      "completedStages": ["String"],
      "notes": ["String"],
      "testScore": "Number",
      "timeSpent": "Number",
      "lastUpdated": "Date"
    }
  ],
  "completedLevels": ["Number"],
  "createdAt": "Date",
  "updatedAt": "Date"
}
```

#### Коллекция Achievements:
```