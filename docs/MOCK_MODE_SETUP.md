# Настройка режима "mock" для локальной разработки

Эта инструкция показывает, как настроить и использовать mock-режим для аутентификации в вашем проекте, что позволяет разрабатывать и тестировать проект без необходимости подключения к сервису Clerk.

## Что такое mock-режим?

Mock-режим предоставляет имитацию аутентификации Clerk, когда реальные API ключи недоступны или когда вы хотите тестировать проект в офлайн-режиме. Он включает в себя:

- Имитацию пользовательского входа/выхода
- Хранение статуса аутентификации в localStorage
- Компоненты для регистрации и входа

## Включение mock-режима

### Шаг 1: Настройте переменные окружения

Создайте или отредактируйте файл `.env.local` в корне проекта:

```bash
# Другие переменные окружения...

# Включение mock-режима
NEXT_PUBLIC_CLERK_MOCK_MODE=true
```

### Шаг 2: Проверьте наличие mock-компонентов

Убедитесь, что в проекте существуют необходимые файлы:

1. `src/components/auth/MockProviders.tsx` - содержит компоненты для имитации Clerk
2. `src/middleware.ts` - должен включать поддержку mock-режима

## Использование mock-режима

### Аутентификация в UI

1. Перейдите на страницу входа
2. Используйте любую комбинацию email/пароль для имитации входа
3. В фоновом режиме будет использован `MockClerkProvider` вместо реального `ClerkProvider`

### Программный доступ

В вашем коде вы можете использовать хуки `useMockUser` и `useMockClerk` так же, как и обычные хуки Clerk:

```tsx
// Пример использования mock-хуков
import { useMockUser, useMockClerk } from '@/components/auth/MockProviders';

function MyComponent() {
  // В режиме mock будет использован mock-хук, иначе реальный хук Clerk
  const { user } = process.env.NEXT_PUBLIC_CLERK_MOCK_MODE === 'true' 
    ? useMockUser() 
    : useUser();
    
  return (
    <div>
      {user ? `Привет, ${user.firstName}!` : 'Пожалуйста, войдите в систему'}
    </div>
  );
}
```

## Переключение между режимами

Для переключения между mock-режимом и реальной аутентификацией Clerk:

1. Измените значение `NEXT_PUBLIC_CLERK_MOCK_MODE` в `.env.local`
2. Перезапустите сервер разработки:

```bash
npm run dev
```

## Использование в CI/CD

Для использования mock-режима в CI/CD добавьте соответствующую переменную окружения в ваш pipeline:

```yaml
# Пример для GitHub Actions
env:
  NEXT_PUBLIC_CLERK_MOCK_MODE: 'true'
```

## Ограничения mock-режима

- Не поддерживаются расширенные функции Clerk (webhook-и, custom roles)
- Данные пользователя заранее определены и не могут быть изменены через API
- Нет реальной защиты маршрутов на сервере, только клиентская имитация

## Устранение неполадок

Если у вас возникли проблемы с mock-режимом:

1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь, что `NEXT_PUBLIC_CLERK_MOCK_MODE` установлен в `true`
3. Очистите localStorage браузера, если ранее вы использовали реальную аутентификацию 